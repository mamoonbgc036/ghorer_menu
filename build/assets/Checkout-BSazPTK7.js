import{d as a,k as o,f as e,r as n,o as ae,z as C,c as q,a as oe,e as O,i as N,j as le,t as l,v as U,n as x,F as V,l as I,m as A,q as R,h as f,u as p,E as de}from"./app-DBtr3_Li.js";import{C as ne,Y as ie,G as ue,V as ce,S as ge}from"./CustomerLayout-DHGMSt5G.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ye(i,u){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"})])}function Z(i,u){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})])}const ve={key:0,id:"modal",class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300 ease-in-out"},me={class:"bg-white rounded-2xl shadow-lg p-6 w-full max-w-md transform transition-all duration-300 scale-95 animate-fadeIn text-gray-700"},xe={key:0,class:"mt-4"},be={class:"block mb-2 text-sm font-medium"},fe={class:"mt-6 flex justify-end"},pe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ke={key:0,class:"mb-4 p-4 bg-red-100 dark:bg-red-900/50 border border-red-400 text-red-700 dark:text-red-300 rounded"},he={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},_e={class:"lg:col-span-2 space-y-6"},we={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ce={class:"flex justify-between items-center mb-4"},Ae={class:"text-lg font-medium text-orange-600 dark:text-orange-400"},Me={key:0,class:"space-y-4"},Pe={class:"text-gray-900 dark:text-gray-200 font-medium"},je={class:"text-sm text-gray-600 dark:text-gray-400"},Se={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},Oe={key:0},Ne={key:1,class:"text-sm text-gray-600 dark:text-gray-400"},Ve={class:"text-gray-900 dark:text-gray-200"},Ie={key:1,class:"text-gray-600 dark:text-gray-400 text-center py-4"},Ee={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Te=["onClick"],ze={class:"flex items-start space-x-3"},De={class:"text-gray-900 dark:text-gray-200 font-medium"},Fe={class:"text-sm text-gray-600 dark:text-gray-400"},qe={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ue={class:"flex items-start space-x-3"},$e={class:"text-gray-900 dark:text-gray-200 font-medium"},Ge={class:"text-sm text-gray-600 dark:text-gray-400"},Ye={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re=["onClick"],Ze={class:"text-gray-900 dark:text-gray-200 capitalize"},He={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Je={class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},Qe={class:"lg:col-span-1"},We={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 sticky top-4"},Ke={class:"space-y-3"},Xe={class:"flex justify-between text-gray-600 dark:text-gray-300"},et={key:0,class:"flex justify-between text-gray-600 dark:text-gray-300"},tt={class:"border-t border-gray-200 dark:border-gray-700 pt-3"},rt={class:"flex justify-between text-lg font-semibold text-gray-900 dark:text-gray-100"},st=["disabled"],at={key:0,class:"mt-3 text-sm text-red-600 dark:text-red-400 text-center"},ot={class:"fixed inset-0 overflow-y-auto"},lt={class:"flex min-h-full items-center justify-center p-4"},dt={class:"mt-4 space-y-4"},nt={class:"flex items-center"},gt={__name:"Checkout",props:{auth:Object,addresses:{type:Array,default:()=>[]},branch:{type:Object,required:!0,validator:i=>i&&typeof i.id<"u"}},setup(i){const u=i,B=n(!1),k=n(null),T=n(""),v=n([]),c=n(null),b=n(null),h=n("mobile"),H=n(""),z=n(!1),M=n(!1),$=n({}),y=n({}),m=n({address_label:"",address:"",latitude:null,longitude:null,is_default:!1});ae(()=>{Q(),c.value==="delivery"&&J()});const J=()=>{var s;if(((s=u.addresses)==null?void 0:s.length)>0){const t=u.addresses.find(r=>r.is_default)||u.addresses[0];b.value=t}},Q=()=>{var s;try{const t=sessionStorage.getItem("foodCart");if(!t){P();return}const r=JSON.parse(t);if(console.log("Cart Data:",r),!r||!r.items||!Array.isArray(r.items)){j("Invalid cart data structure"),sessionStorage.removeItem("foodCart"),P();return}if(!((s=u.branch)!=null&&s.id)){j("Branch data is missing"),P();return}if(Number(r.branchId)!==Number(u.branch.id)){j("Cart belongs to a different branch"),P();return}v.value=r.items,c.value=r.orderType,console.log("Order Type set to:",c.value)}catch(t){console.error("Error loading cart:",t),j("Error loading cart data"),sessionStorage.removeItem("foodCart"),P()}},P=()=>{var s;(s=u.branch)!=null&&s.id?C.visit(route("customer.branch.menu",{branch:u.branch.id})):C.visit("/")},j=s=>{$.value={message:s},setTimeout(()=>{$.value={}},5e3)},S=q(()=>{var s;return(s=v.value)!=null&&s.length?v.value.reduce((t,r)=>t+Number(r.total),0):0}),D=q(()=>c.value==="delivery"?2.99:0),G=q(()=>{const s=S.value;return c.value==="delivery"?s+D.value:s}),W=()=>c.value==="delivery"&&!b.value?(y.value.address="Please select a delivery address",!1):!0,K=()=>h.value?!0:(y.value.payment="Please select a payment method",!1),X=()=>{var s;return(s=v.value)!=null&&s.length?!0:(y.value.cart="Your cart is empty",!1)},ee=()=>{const s=u.branch.minimum_order||0;return S.value<s?(y.value.minimum=`Minimum order amount is £${s}`,!1):!0},Y=()=>{var r,g,_;const s={order_type:c.value,branch_id:u.branch.id,items:v.value.map(d=>({food_id:d.food.id,quantity:d.quantity,extras:d.extras,special_instructions:d.specialInstructions||"",unit_price:d.food.base_price,subtotal:d.total})),payment_method:h.value==="mobile"?k.value:h.value,paymentRef:T.value,subtotal:S.value,total_amount:G.value};y.value={},X()&&W()&&K()&&ee()&&(M.value=!0,c.value==="delivery"&&(s.delivery_address=(r=b.value)==null?void 0:r.address,s.delivery_latitude=(g=b.value)==null?void 0:g.latitude,s.delivery_longitude=(_=b.value)==null?void 0:_.longitude,s.delivery_notes=H.value,s.delivery_fee=D.value),console.log("Submitting order:",s),C.post(route("customer.orders.store"),s,{onSuccess:d=>{sessionStorage.removeItem("foodCart");const w=d.url.split("/");console.log(w);const E=w[w.length-1];E?C.visit(route("customer.orders.show",{order:E})):(j("Failed to process order. Please try again."),M.value=!1)},onError:d=>{console.error("Error:",d),M.value=!1,y.value=d}}))},te=()=>{h.value!="mobile"?Y():B.value=!0},re=()=>{z.value=!0},F=()=>{z.value=!1,m.value={address_label:"",address:"",latitude:null,longitude:null,is_default:!1},y.value={}},se=()=>{C.post(route("customer.addresses.store"),m.value,{onSuccess:()=>{F(),C.reload({only:["addresses"]})},onError:s=>{y.value=s}})},L=s=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(Number(s));return(s,t)=>(a(),oe(ne,null,{default:O(()=>[B.value?(a(),o("div",ve,[e("div",me,[t[7]||(t[7]=e("h2",{class:"text-xl font-semibold mb-4 text-center"},"Complete Payment",-1)),t[8]||(t[8]=e("label",{class:"block mb-2 text-sm font-medium"},"Choice Payment Method",-1)),N(e("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>k.value=r),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"},t[6]||(t[6]=[e("option",{value:""},"Choose an option",-1),e("option",{value:"bikash"},"Bikash",-1),e("option",{value:"nogod"},"Nogod",-1),e("option",{value:"rocket"},"Rocket",-1)]),512),[[le,k.value]]),k.value?(a(),o("div",xe,[e("p",null,"Pay to following "+l(k.value)+" number: 0122514244225",1),e("div",null,[e("label",be,"Enter "+l(k.value)+" reference number:",1),N(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>T.value=r)},null,512),[[U,T.value]])])])):x("",!0),e("div",fe,[e("button",{onClick:t[2]||(t[2]=r=>B.value=!1),class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition"},"Close"),e("button",{onClick:Y,class:"ml-3 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"},"Complete Payment")])])])):x("",!0),e("div",pe,[Object.keys(y.value).length>0?(a(),o("div",ke,[(a(!0),o(V,null,I(y.value,(r,g)=>(a(),o("p",{key:g},l(r),1))),128))])):x("",!0),e("div",he,[e("div",_e,[e("div",we,[e("div",Ce,[t[9]||(t[9]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Order Summary",-1)),e("div",Ae,l(c.value==="delivery"?"Delivery Order":"Collection Order"),1)]),v.value.length?(a(),o("div",Me,[(a(!0),o(V,null,I(v.value,r=>{var g;return a(),o("div",{key:r.id,class:"flex justify-between items-start border-b border-gray-200 dark:border-gray-700 pb-4"},[e("div",null,[e("h3",Pe,l(r.food.name),1),e("p",je,"Quantity: "+l(r.quantity),1),(g=r.extras)!=null&&g.length?(a(),o("div",Se,[t[10]||(t[10]=A(" Extras: ")),(a(!0),o(V,null,I(r.extras,(_,d)=>{var w;return a(),o("span",{key:_},[A(l((w=r.food.extra_options.find(E=>E.id===_))==null?void 0:w.name)+" ",1),d<r.extras.length-1?(a(),o("span",Oe,",")):x("",!0)])}),128))])):x("",!0),r.specialInstructions?(a(),o("p",Ne,"Note: "+l(r.specialInstructions),1)):x("",!0)]),e("span",Ve,[t[11]||(t[11]=e("span",{style:{"font-size":"30px"}},"৳",-1)),A(" "+l(r.total),1)])])}),128))])):(a(),o("div",Ie,"Your cart is empty"))]),e("div",Ee,[e("div",{class:"flex justify-between items-center mb-4"},[t[12]||(t[12]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Delivery Address",-1)),e("button",{onClick:re,class:"text-orange-600 dark:text-orange-400 hover:text-orange-700 dark:hover:text-orange-300"},"+ Add New Address")]),e("div",Be,[(a(!0),o(V,null,I(i.addresses,r=>{var g;return a(),o("div",{key:r.id,onClick:_=>b.value=r,class:R(["border rounded-lg p-4 cursor-pointer transition-colors duration-200",[((g=b.value)==null?void 0:g.id)===r.id?"border-orange-500 bg-orange-50 dark:bg-gray-700":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600"]])},[e("div",ze,[f(p(Z),{class:"w-5 h-5 text-gray-400 flex-shrink-0"}),e("div",null,[e("p",De,l(r.address_label),1),e("p",Fe,l(r.address),1)])])],10,Te)}),128))])]),e("div",qe,[t[14]||(t[14]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Food Provider",-1)),e("div",Ue,[f(p(Z),{class:"w-5 h-5 text-gray-400 flex-shrink-0"}),e("div",null,[e("p",$e,l(i.branch.name),1),e("p",Ge,l(i.branch.address),1),t[13]||(t[13]=e("p",{class:"mt-2 text-sm text-orange-600"},"Please collect your order from this location",-1))])])]),e("div",Ye,[t[15]||(t[15]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Payment Method",-1)),e("div",Le,[(a(),o(V,null,I(["cash","mobile"],r=>e("button",{key:r,onClick:g=>h.value=r,class:R(["flex items-center space-x-3 border rounded-lg p-4 transition-colors duration-200",[h.value===r?"border-orange-500 bg-orange-50 dark:bg-gray-700":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600"]])},[f(p(ye),{class:"w-5 h-5 text-gray-400"}),e("span",Ze,l(r=="cash"?r:"Mobile Payment"),1)],10,Re)),64))])]),e("div",He,[e("h2",Je,l(c.value==="delivery"?"Delivery Instructions":"Instructions"),1)])]),e("div",Qe,[e("div",We,[t[21]||(t[21]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Order Total",-1)),e("div",Ke,[e("div",Xe,[t[17]||(t[17]=e("span",null,"Subtotal",-1)),e("span",null,[t[16]||(t[16]=e("span",{style:{"font-size":"30px"}},"৳",-1)),A(" "+l(S.value),1)])]),c.value==="delivery"?(a(),o("div",et,[t[18]||(t[18]=e("span",null,"Delivery Fee",-1)),e("span",null,l(L(D.value)),1)])):x("",!0),e("div",tt,[e("div",rt,[t[20]||(t[20]=e("span",null,"Total",-1)),e("span",null,[t[19]||(t[19]=e("span",{style:{"font-size":"30px"}},"৳",-1)),A(" "+l(G.value),1)])])])]),e("button",{onClick:te,disabled:M.value||!v.value.length,class:"w-full mt-6 bg-orange-600 text-white py-3 px-4 rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},l(M.value?"Processing...":"Place Order"),9,st),S.value<(i.branch.minimum_order||0)?(a(),o("div",at,"Minimum order amount is "+l(L(i.branch.minimum_order)),1)):x("",!0)])])])]),f(p(ge),{appear:"",show:z.value,as:"template"},{default:O(()=>[f(p(ie),{as:"div",onClose:F,class:"relative z-50"},{default:O(()=>[t[26]||(t[26]=e("div",{class:"fixed inset-0 bg-black/50"},null,-1)),e("div",ot,[e("div",lt,[f(p(ue),{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 p-6 text-left align-middle shadow-xl transition-all"},{default:O(()=>[f(p(ce),{as:"h3",class:"text-lg font-medium text-gray-900 dark:text-gray-100"},{default:O(()=>t[22]||(t[22]=[A("Add New Address")])),_:1}),e("div",dt,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Address Label ",-1)),N(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=r=>m.value.address_label=r),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200",placeholder:"Home, Work, etc."},null,512),[[U,m.value.address_label]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Full Address ",-1)),N(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=r=>m.value.address=r),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"},null,512),[[U,m.value.address]])]),e("div",nt,[N(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=r=>m.value.is_default=r),class:"rounded border-gray-300 dark:border-gray-600 text-orange-600 focus:ring-orange-500"},null,512),[[de,m.value.is_default]]),t[25]||(t[25]=e("label",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," Set as default address ",-1))])]),e("div",{class:"mt-6 flex justify-end space-x-3"},[e("button",{onClick:F,class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"},"Cancel"),e("button",{onClick:se,class:"px-4 py-2 text-sm bg-orange-600 text-white rounded-md hover:bg-orange-700 transition-colors duration-200"},"Save Address")])]),_:1})])])]),_:1})]),_:1},8,["show"])]),_:1}))}};export{gt as default};
