import{d as o,k as l,f as e,r as d,o as ae,z as k,c as F,a as oe,e as M,i as P,j as le,t as a,v as T,n as _,F as j,l as S,m as O,q as R,h as x,u as f,E as de}from"./app-Uxo1qTBw.js";import{C as ne,Y as ie,G as ue,V as ce,S as ge}from"./CustomerLayout-C4m_X95K.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ve(n,i){return o(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"})])}function Z(n,i){return o(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})])}const ye={key:0,id:"modal",class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300 ease-in-out"},me={class:"bg-white rounded-2xl shadow-lg p-6 w-full max-w-md transform transition-all duration-300 scale-95 animate-fadeIn text-gray-700"},be={key:0,class:"mt-4"},xe={class:"block mb-2 text-sm font-medium"},fe={class:"mt-6 flex justify-end"},pe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},he={key:0,class:"mb-4 p-4 bg-red-100 dark:bg-red-900/50 border border-red-400 text-red-700 dark:text-red-300 rounded"},ke={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},_e={class:"lg:col-span-2 space-y-6"},we={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ce={class:"flex justify-between items-center mb-4"},Ae={class:"text-lg font-medium text-orange-600 dark:text-orange-400"},Me={key:0,class:"space-y-4"},Pe={class:"text-gray-900 dark:text-gray-200 font-medium"},je={class:"text-sm text-gray-600 dark:text-gray-400"},Se={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},Oe={class:"text-gray-900 dark:text-gray-200"},Ne={key:1,class:"text-gray-600 dark:text-gray-400 text-center py-4"},Ve={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be=["onClick"],Ee={class:"flex items-start space-x-3"},ze={class:"text-gray-900 dark:text-gray-200 font-medium"},De={class:"text-sm text-gray-600 dark:text-gray-400"},Fe={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Te={class:"flex items-start space-x-3"},qe={class:"text-gray-900 dark:text-gray-200 font-medium"},Ue={class:"text-sm text-gray-600 dark:text-gray-400"},$e={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ye=["onClick"],Le={class:"text-gray-900 dark:text-gray-200 capitalize"},Re={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ze={class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},He={class:"lg:col-span-1"},Je={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 sticky top-4"},Qe={class:"space-y-3"},We={class:"flex justify-between text-gray-600 dark:text-gray-300"},Ke={key:0,class:"flex justify-between text-gray-600 dark:text-gray-300"},Xe={class:"border-t border-gray-200 dark:border-gray-700 pt-3"},et={class:"flex justify-between text-lg font-semibold text-gray-900 dark:text-gray-100"},tt=["disabled"],rt={key:0,class:"mt-3 text-sm text-red-600 dark:text-red-400 text-center"},st={class:"fixed inset-0 overflow-y-auto"},at={class:"flex min-h-full items-center justify-center p-4"},ot={class:"mt-4 space-y-4"},lt={class:"flex items-center"},ut={__name:"Checkout",props:{auth:Object,addresses:{type:Array,default:()=>[]},branch:{type:Object,required:!0,validator:n=>n&&typeof n.id<"u"}},setup(n){const i=n,N=d(!1),p=d(null),V=d(""),v=d([]),u=d(null),b=d(null),h=d("mobile"),H=d(""),I=d(!1),w=d(!1),q=d({}),c=d({}),y=d({address_label:"",address:"",latitude:null,longitude:null,is_default:!1});ae(()=>{Q(),u.value==="delivery"&&J()});const J=()=>{var s;if(((s=i.addresses)==null?void 0:s.length)>0){const t=i.addresses.find(r=>r.is_default)||i.addresses[0];b.value=t}},Q=()=>{var s;try{const t=localStorage.getItem("selectedItem");if(!t){C();return}const r=JSON.parse(t);if(console.log("Cart Data:",r),!r||!r.items||!Array.isArray(r.items)){console.log("Invalid cart data structure"),sessionStorage.removeItem("foodCart"),C();return}if(!((s=i.branch)!=null&&s.id)){console.log("Branch data is missing"),C();return}if(Number(r.items[0].branch_id)!==Number(i.branch.id)){console.log("Cart belongs to a different branch"),C();return}v.value=r.items,console.log("cart itmes",v.value),u.value=r.order_type,console.log("Order Type set to:",u.value)}catch(t){console.error("Error loading cart:",t),U("Error loading cart data"),sessionStorage.removeItem("foodCart"),C()}},C=()=>{var s;(s=i.branch)!=null&&s.id?k.visit(route("customer.branch.menu",{branch:i.branch.id})):k.visit("/")},U=s=>{q.value={message:s},setTimeout(()=>{q.value={}},5e3)},A=F(()=>{var s;return(s=v.value)!=null&&s.length?v.value.reduce((t,r)=>t+Number(r.total),0):0}),B=F(()=>u.value==="delivery"?2.99:0),$=F(()=>{const s=A.value;return u.value==="delivery"?s+B.value:s}),W=()=>u.value==="delivery"&&!b.value?(c.value.address="Please select a delivery address",!1):!0,K=()=>h.value?!0:(c.value.payment="Please select a payment method",!1),X=()=>{var s;return(s=v.value)!=null&&s.length?!0:(c.value.cart="Your cart is empty",!1)},ee=()=>{const s=i.branch.minimum_order||0;return A.value<s?(c.value.minimum=`Minimum order amount is £${s}`,!1):!0},G=()=>{var r,m,z;const s={order_type:u.value,branch_id:i.branch.id,items:v.value.map(g=>({food_id:g.id,quantity:g.qty,special_instructions:g.instructions||"",unit_price:g.base_price,subtotal:g.total})),payment_method:h.value==="mobile"?p.value:h.value,paymentRef:V.value,subtotal:A.value,total_amount:$.value};c.value={},X()&&W()&&K()&&ee()&&(w.value=!0,u.value==="delivery"&&(s.delivery_address=(r=b.value)==null?void 0:r.address,s.delivery_latitude=(m=b.value)==null?void 0:m.latitude,s.delivery_longitude=(z=b.value)==null?void 0:z.longitude,s.delivery_notes=H.value,s.delivery_fee=B.value),console.log("Submitting order:",s),k.post(route("customer.orders.store"),s,{onSuccess:g=>{localStorage.removeItem("selectedItem");const D=g.url.split("/");console.log(D);const L=D[D.length-1];L?k.visit(route("customer.orders.show",{order:L})):(U("Failed to process order. Please try again."),w.value=!1)},onError:g=>{console.error("Error:",g),w.value=!1,c.value=g}}))},te=()=>{h.value!="mobile"?G():N.value=!0},re=()=>{I.value=!0},E=()=>{I.value=!1,y.value={address_label:"",address:"",latitude:null,longitude:null,is_default:!1},c.value={}},se=()=>{k.post(route("customer.addresses.store"),y.value,{onSuccess:()=>{E(),k.reload({only:["addresses"]})},onError:s=>{c.value=s}})},Y=s=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(Number(s));return(s,t)=>(o(),oe(ne,null,{default:M(()=>[N.value?(o(),l("div",ye,[e("div",me,[t[7]||(t[7]=e("h2",{class:"text-xl font-semibold mb-4 text-center"},"Complete Payment",-1)),t[8]||(t[8]=e("label",{class:"block mb-2 text-sm font-medium"},"Choice Payment Method",-1)),P(e("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>p.value=r),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"},t[6]||(t[6]=[e("option",{value:""},"Choose an option",-1),e("option",{value:"bikash"},"Bikash",-1),e("option",{value:"nogod"},"Nogod",-1),e("option",{value:"rocket"},"Rocket",-1)]),512),[[le,p.value]]),p.value?(o(),l("div",be,[e("p",null,"Pay to following "+a(p.value)+" number: 0122514244225",1),e("div",null,[e("label",xe,"Enter "+a(p.value)+" reference number:",1),P(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>V.value=r)},null,512),[[T,V.value]])])])):_("",!0),e("div",fe,[e("button",{onClick:t[2]||(t[2]=r=>N.value=!1),class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition"},"Close"),e("button",{onClick:G,class:"ml-3 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"},"Complete Payment")])])])):_("",!0),e("div",pe,[Object.keys(c.value).length>0?(o(),l("div",he,[(o(!0),l(j,null,S(c.value,(r,m)=>(o(),l("p",{key:m},a(r),1))),128))])):_("",!0),e("div",ke,[e("div",_e,[e("div",we,[e("div",Ce,[t[9]||(t[9]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Order Summary",-1)),e("div",Ae,a(u.value==="delivery"?"Delivery Order":"Collection Order"),1)]),v.value.length?(o(),l("div",Me,[(o(!0),l(j,null,S(v.value,r=>(o(),l("div",{key:r.id,class:"flex justify-between items-start border-b border-gray-200 dark:border-gray-700 pb-4"},[e("div",null,[e("h3",Pe,a(r.name),1),e("p",je,"Quantity: "+a(r.qty),1),r.instructions?(o(),l("p",Se,"Note: "+a(r.instructions),1)):_("",!0)]),e("span",Oe,[t[10]||(t[10]=e("span",{style:{"font-size":"30px"}},"৳",-1)),O(" "+a(r.total),1)])]))),128))])):(o(),l("div",Ne,"Your cart is empty"))]),e("div",Ve,[e("div",{class:"flex justify-between items-center mb-4"},[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Delivery Address",-1)),e("button",{onClick:re,class:"text-orange-600 dark:text-orange-400 hover:text-orange-700 dark:hover:text-orange-300"},"+ Add New Address")]),e("div",Ie,[(o(!0),l(j,null,S(n.addresses,r=>{var m;return o(),l("div",{key:r.id,onClick:z=>b.value=r,class:R(["border rounded-lg p-4 cursor-pointer transition-colors duration-200",[((m=b.value)==null?void 0:m.id)===r.id?"border-orange-500 bg-orange-50 dark:bg-gray-700":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600"]])},[e("div",Ee,[x(f(Z),{class:"w-5 h-5 text-gray-400 flex-shrink-0"}),e("div",null,[e("p",ze,a(r.address_label),1),e("p",De,a(r.address),1)])])],10,Be)}),128))])]),e("div",Fe,[t[13]||(t[13]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Food Provider",-1)),e("div",Te,[x(f(Z),{class:"w-5 h-5 text-gray-400 flex-shrink-0"}),e("div",null,[e("p",qe,a(n.branch.name),1),e("p",Ue,a(n.branch.address),1),t[12]||(t[12]=e("p",{class:"mt-2 text-sm text-orange-600"},"Please collect your order from this location",-1))])])]),e("div",$e,[t[14]||(t[14]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Payment Method",-1)),e("div",Ge,[(o(),l(j,null,S(["cash","mobile"],r=>e("button",{key:r,onClick:m=>h.value=r,class:R(["flex items-center space-x-3 border rounded-lg p-4 transition-colors duration-200",[h.value===r?"border-orange-500 bg-orange-50 dark:bg-gray-700":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600"]])},[x(f(ve),{class:"w-5 h-5 text-gray-400"}),e("span",Le,a(r=="cash"?r:"Mobile Payment"),1)],10,Ye)),64))])]),e("div",Re,[e("h2",Ze,a(u.value==="delivery"?"Delivery Instructions":"Instructions"),1)])]),e("div",He,[e("div",Je,[t[20]||(t[20]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Order Total",-1)),e("div",Qe,[e("div",We,[t[16]||(t[16]=e("span",null,"Subtotal",-1)),e("span",null,[t[15]||(t[15]=e("span",{style:{"font-size":"30px"}},"৳",-1)),O(" "+a(A.value),1)])]),u.value==="delivery"?(o(),l("div",Ke,[t[17]||(t[17]=e("span",null,"Delivery Fee",-1)),e("span",null,a(Y(B.value)),1)])):_("",!0),e("div",Xe,[e("div",et,[t[19]||(t[19]=e("span",null,"Total",-1)),e("span",null,[t[18]||(t[18]=e("span",{style:{"font-size":"30px"}},"৳",-1)),O(" "+a($.value),1)])])])]),e("button",{onClick:te,disabled:w.value||!v.value.length,class:"w-full mt-6 bg-orange-600 text-white py-3 px-4 rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},a(w.value?"Processing...":"Place Order"),9,tt),A.value<(n.branch.minimum_order||0)?(o(),l("div",rt,"Minimum order amount is "+a(Y(n.branch.minimum_order)),1)):_("",!0)])])])]),x(f(ge),{appear:"",show:I.value,as:"template"},{default:M(()=>[x(f(ie),{as:"div",onClose:E,class:"relative z-50"},{default:M(()=>[t[25]||(t[25]=e("div",{class:"fixed inset-0 bg-black/50"},null,-1)),e("div",st,[e("div",at,[x(f(ue),{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 p-6 text-left align-middle shadow-xl transition-all"},{default:M(()=>[x(f(ce),{as:"h3",class:"text-lg font-medium text-gray-900 dark:text-gray-100"},{default:M(()=>t[21]||(t[21]=[O("Add New Address")])),_:1}),e("div",ot,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Address Label ",-1)),P(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=r=>y.value.address_label=r),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200",placeholder:"Home, Work, etc."},null,512),[[T,y.value.address_label]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Full Address ",-1)),P(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=r=>y.value.address=r),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"},null,512),[[T,y.value.address]])]),e("div",lt,[P(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=r=>y.value.is_default=r),class:"rounded border-gray-300 dark:border-gray-600 text-orange-600 focus:ring-orange-500"},null,512),[[de,y.value.is_default]]),t[24]||(t[24]=e("label",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," Set as default address ",-1))])]),e("div",{class:"mt-6 flex justify-end space-x-3"},[e("button",{onClick:E,class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"},"Cancel"),e("button",{onClick:se,class:"px-4 py-2 text-sm bg-orange-600 text-white rounded-md hover:bg-orange-700 transition-colors duration-200"},"Save Address")])]),_:1})])])]),_:1})]),_:1},8,["show"])]),_:1}))}};export{ut as default};
